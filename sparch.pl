#! /usr/bin/perl
use v5.30;
use strict;
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "RCOP8sdeKrBZ6pbc";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

my $done = do './bin/install' if $run;
if($!) {
  die "$done: $!\n";
}

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. By default the original archive is deleted after extraction.

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
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