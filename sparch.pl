#! /usr/bin/perl
use v5.30;
use strict; 
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;
use Cwd;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "PJfbkmyVIywiOYGS";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

my $curr_dir = getcwd(); chdir 'bin';
my $done = do './install' if $run;
if($!) {
  die "$done: $!\n";
}
chdir $curr_dir;

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. By default the original archive is deleted after extraction.

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
H4sIAAAAAAAA/+1aa3MaRxb118yv6GBXgFpAQrKcirCVEAk72rUllZB2HUdZqplpoFfDDJmHsGz5v+99dPfMALKdrWTzxVOJNY9+3L6Pc8/tRkdpJsPwwZ95bW9vf7u3h3+73+516bn77e6DB4Kv7t5u90H38ePu49297s7e7gPR3d15/OSB2P5TpTJXDutPQKQkjyKV3N8uiP3rj33fpqv4O9bRHy3qn3E9/Fps5WmyBeJuLVQSel6eKnGz19nd7tFtmiXaz/h+KZNIR9OUn57rUO3vH8aL257nPRQXM50K+C+bQaeFTPyZ0OxcMtNxJCbQvCOOs3oqpEj1fBFCOz/Riwy6yEz48UIr6g6DlQZBqVzDmKUNY1+GKLPnzW/Fo0ClmY5omlGgE+VncXIrnolatXGtR61RkFEWj2BCasTzwEcvj0KVpqLRDu4Zsynee1+l8lbULkDAQE1kHmbVZRbz3yNWEMMqozgT6q1Osw7M+9Ui0VEmasOF8vXkFtQT6MlEJQpeFv0mcVKZaV9g13vX/nR4cXR8cgBN/Fk8X9wjTc/7YFb92Yt2c9zGOdgIRdYqWFkWikZdDhMlM0X2LHrKKBAZ/p1Ksgo3HWbxYgHuVVllrYcDZqILglpJ0XCNihlb94lOsicqy5MIZInzMCAZyfRVRwDX2jxGDWb2Z/M4EIhiLVHb3GyrMlyt91cH9mde7Px/7hwfx/+d3W53dxX/uwChX/D//3D9j/jvxXkifjge9gFpfls2mubNo38OzofHpyfwtr7d2e7WezzeCwWxne3vv4whvKH9vh9HEz2FWBzpaRQnauRLaAaPMocIkuNxom6aPGkf/FPfQKa5kAm/eXX8arC//yP0ePK4nIqe6yjg57M42N+/TOVUUWo6ZwDwY4hcL83HYnB+PhpeHh4OhkPxXmyLD2L1eiiGue8D2rj2F/1zaNvd0JbbD5IEEFqStKAk1+/07AI0MhxdnpwPDk9fnBy/GRzBQDs80ENxGQGCxNNIvwMUBS0BqqRiksRz1NrpInMDPT9+ORidnA5OLqD77qocD0kJAkTYnGoyTpU+5IIElgWzcDbM1HwxQugCmyUAzPGcniI5V2DW1TleKAgSBHRpGgvbGAF0rARoP6Bx4zxb5Bk6Qp0nMim8eAFylp5mKlzA4zY/zWVUPPgz17QizJFbKMztz2Q0VZA7SA5IlgpWrfw8w4xCdILnLzLW+Fa02/wWp/kBV5KSvxzOlH8t9ES8foOMRt5IHcox0ZcJ6rNF2evHN8dnO/SK7qhlmMakcNelhXNHjiqAcC+gMcxxEoMWvxNzJcHcdRRwDGlFTN/phSgZSYTqRoV1r2w4UIW6kWH98PTV2Tm48Oj1m7q4u1t5iULR6+9oTWcygcCo+BdOCsPOMR2HOlIeOxw2aHio4job8S5+ltbFswNxZaza4q+su7vUfeUX5ivY7C5wn+DJvCc1302epe+7rQ/8lVVvvqMj3M3uvjcd8dF8AUHNS7gz78g37nw3Dz17TYyDRRzs5IgBjR2AkuKp20TT0sDl120MEtAgjrPdEu0blYxjUBk87nAPmBVUCboEk6NHag4uNAtSNVQjLaT81tgfWBDqGAwcT0wjMkGaBUBiDa/hkACLsT4EkhdcJEUPNqTI7NG75QxuG6XXBeWz3fAy3G+1N16LPJ2ZmVrrLT4g37JBfHf3jHyhXsUDUkS7bRoZbZj4ClTQKns9dS8Bg5XZTtER9c4irJfCD/luFEdt4pOoX1YKapngDMeC7yP3nfBCTxq8JtYCDFI8C1qZpbuq0BPRzxMIrMpc4tGoZtW1OlPXaon/J4q6gtHoMeVeSLU9ozLjPQ6LWmKqwIHCsOwbVBU5MO9wgRUpFaQGa4MYYhYWjG7TNKtDIIPHFGTk9z1rK1ufRQrTmgQAGytfYraEkIyCusjkNekXclgCCiEPE0tF77FkgypKJjQJtm9cfbOUUYay04RNXl6J73MqhIxLaUYigpdzefsgUsue9X1s0D7wqffI9GwUyalVyVwt47dNNiEXGgW5ZxHMIFAmgXPx8ApTdK9sL0jqxi6nCwhTFLtmXLLGToBuuEw0phGUVUfXFRdeyZBFLk4g1gMVKqMM4+Y0JHiGRmsjKNyyz6VeDPM3SvEB6SzAddcPDuqtypRNTvIg6aGMcMHYtdJiXzz6usahZOAdHIazIVpyCmqJbD6Uk0wl8DFLpI/Q3zEpF7NppaC0Cfybb2xG/l789tsv0BpQN0+SESdpcGR/GSB14EZ1blzv/Sr2XbI3soxs9ilGxzEbNCZ6N3wIADs6W+ZzHXV39Qi4eq9ZGo4LvKq0ayugkVmmQmA3jMc1eFX74unT2uD0OahyjSZvZsliwzbJ5/DXMj/mN4dLoLIeKQJWy4hDT9dKFTzpaoUW1MrPNdOkzPBqxRM7yFkSIxxYHoA0wJKEFTpQj+I2iEJ5FijpeycZ0GdMxnWUjLPwlRGT83AjncXLkRl0RDHYaKIbcWGPtcP8Gs3iIq/nsZ1KL2yESoELiBPEr2WcXCO7w9W4+DHrLcIHoqekg83BU4zJ4XNF8QPGhrJfVYckUdh27UBhScGbGzKTQmaZ9GeKwi1DuC3Y5dWjMfUZUUPI1Uf9i/5Bz7hdZQbBw464Q6PSE5Tlh8hK1mU6Utb2JkdSRJNwZHyDh14Vg00zB7lXZcytuBfaaS2qvNVQxnwE2mNgJj1zJJNOr67QKT94awHrWWgtTW+doN7p1HvF922TwE0ogFBYH627mMsMT58OTn8avDzreZfD/ovBPrxut7ErpbJ/oJ+WstU6Hoofbwsig0ie6KmOgCfaHmBnBvpgA5jSbBw5NN8R1wcYOfcBMFKEskRLmZqcFoilzmYQA7ZuMaHKXLhU5Cw1UImxrYA2CeakQqIK6SBLy/2Jf+COCIRXx2P94VLMTlrX5My+83eZOHGty+Cs4IfsvEJF6NOBNxqh449GMOhzj4JWNFwZ6oL2Kaa8TTHrkjznPNfEZDwbsZXgWEvO60wI68c4QWcMb5mru7DRkYBRJfooc276XJUXFzDOccu2JZ7s7e0+YfffmFJYETa4Xbd6vUlK5ei+T35I6PQdpatiluMmRfxUF90HWxg+AuS5vKG5TmeQglM1Dalurin6iXPOkQmWmQz7F9a56A5DCMQkxoq7vBuAdTbuzOD+DLTDaGXiaOg35CCsRAzxjXOQM48IQJUthJiQyhB3jygC8JCA+8Zwm5jOYD8FHhisVbeVrLZe+xS7R/v7uJWBduDllFYztTsfpX0Pga15h2hl64TWZg8b6AXvdDBBBxRlhl7v10UHSp834O91yffv8H6b77/D+zb+M0L/4Hqmi5+6T2z5UkzRYdqTpL/gNkgDRWrwXM3mrz1TqpgQdr3I60ajwckRBKX3bAbe3RUn/VcDzxuaUxw8sMniOCQuTEiEWTdV4cQhCjzTOY3l/FitgKpUCqhpUzQPVDnOoXMfqDjAVRCKiKUWactjs+qoDIcAqVbK4c8np2fD4yEikzks4tJqIbPZVhZvTeIwAO9wJaqFKAef/KedMRK228YJ4d8u/btTHhk3DIrJjwbDw/Nj2tsra4o8fk1P7Y/ryWWSjJSqC7xHBC0Bap7iCOUMzgN4haZLWYl2Hhho2gZ/zQhlBkpzlJlLxUag7n/hMG45JVO0rG4mVO3AGIA9GSEFUtjXb8obWZTWeD+tskHGUgIRhC4p7aS1SCLN22rY3lvZUdOZTcg0F26ZgZhUWNv8J9Py0VSeWMl5GcCV40l1JXzgaHuU0yh6Rr6gzYFSWrduYHZ3Pa/tw/S8+4RRWT0qWwJIqU/uQuJa8bASDN8Rp+UJnaaZf6WOYAalLVCal8LIzWM2DYpWGlEST9ZulDAYSx/xW1UlsMZ2wPG0YUHmxDbKpI5SlywbaZMcqBhhYoOKxnhZ2QCjMYC4YUofq9UwZ8mLz/gtlKmlPOgfTokdMbhRyS1ohMwMw0Lkh/GSz6MhaRG0kAhjZWenBCWDwNL1giF7bRfuRNl0ugjlLca2hJzIMNCOHaxAoxOEX6O/9VDkk2+DESbSUtFZhHZiQu+KS5BxeaX3QmlUSr+4uDKyNjjB/+1t09BJN9zKPh3u3xjfogCEJaFgMi0E+/i6QBVpsY8uRL8C7jAZDJ6t+BbuLcGEayw1jvzK1pGYgRxjpVwooKkviiia5+APaMWPqIKAYQw0weQGxBYL9DJhitKirTfrxS7jVA+sq01WAphf2gWxV2nLYrwiIPD8QGniLCxOFCeuu0kfZsuYuEURLXZsop9EcGi3F8bsh2ncKpJcGRrrbM46tEK1cVSgCe05AGqggOLlTEUrpybWElaZXDqJ3187McRaFhWsDLxeRK1Zo/CJG7XBKTBPoFDGywOd4pJSdv2xgl4aTyjRkriCdHMtx5XyyjJw1aUSDmxIm6Quz1aKMxx2tTzbnF2gp/N80nx5lfTRLe8yZXusLPLTpZvLU4PX/VdnLwfDVUdQbyX9Eofcy+6cFqsDiE91St5gQthEDqQhcS2h7pMija+vkSAuZuJdfo1piGR0vOnTPbxjs/hxfKOsSC23P+1cG9P6CnZtRiYbLBhDgcE0z6MjN4IlK5RJLzJcIr6PTYZBY4BiEyAa9dQe5KCPSXy2Uqki5bDD6KySbkzOshAq2bc8/qIjP8wZJFaSbtU895jFFTgbwQhwpSOKxZKjLzDsDPwDquVJSsEXFzGGVYxnIU8bdLRyelWTInKNVQTkOvW8vyMKh/qa14s+CZGWFmb8vETibGYykFUzx5NxAOP31g8QLY3KIogW58xzOsnA3vF92N8RfXfaci/cfzbUe6sM4j5tfWY4fCJLVP0/2pQhYE2lJCGex4nVzopwRrMwTnuKQtFXd8MScg+UkjeaQFK6MeEuxL9ff3YMu4mqJP2+SK64BoezG4GC+iImzivv205rmTlu1/zQknw659pU32zkGhvozIpGLf9RMmmj2XHUP0jP5TELxZdZNIQFqcjEPag+KRfp5RQz19MZ0gVfB9QPQQsycFk3qFlw+jy1fd2uoY1EdD9v8wSlQn0wEP2Xw1MolBVHdIFwZ0jVgKvm6MLlyrZVqVKBP0NX+n0F9r+M9Fvak0AMl0mj22zhJiT9ffuO/mBZSDdjuNmBu0Ke/uXFT6fnnnek/qNFP1DTsc7AVwdPw+yAiho/+yGAb9J86kAdO3g6zQ6KIQ5Pz34+P37x04XonxyJl8eHg5PhwPPw17AJ6bVx2BQ72zs7qL/KPIhXWOjpMW3eaTztVQjFk2wJkNuj31XipkiigMRkiR7ntGeHqLQFYQy6Qm/Gihkhhc1FP8BRyTxF5k4q5b2EljA4Qu8gY9FBkYcHV51doD/AfDOcMHFURUa3kAUxhmxrcHbqvUeSzeUtU7DiVzGoFaAxf/VP2b5cX64v15fry/U7rv8C1vJRMQA0AAA=