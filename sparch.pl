#! /usr/bin/perl
use v5.30;
use strict;
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "upJFgvxGyPCeBzpg";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

my $done = do './install' if $run;
if($!) {
  die "$done: $!\n";
}

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. By default the original archive is deleted after extraction.

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
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