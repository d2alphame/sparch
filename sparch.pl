#! /usr/bin/perl
use v5.30;
use strict;
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "awgTweDb38n7g20g";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

my $done = do './install' if $run;
if($!) {
  die "$done: $!\n";
}

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. By default the original archive is deleted after extraction.

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
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