#! /usr/bin/perl
use v5.30;
use strict;
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "mb1e50PrK2ZZKt2_";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

do './install' if $run;
if($!) {
  die "$!\n";
}

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. The script is deleted by default.

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
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