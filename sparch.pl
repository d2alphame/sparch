#! /usr/bin/perl
use v5.30;
use strict;
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "B7nSXVHDmzNvsQ-F";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

chdir 'bin';
my $done = do './install' if $run;
if($!) {
  die "$done: $!\n";
}

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. By default the original archive is deleted after extraction.

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
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