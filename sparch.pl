#! /usr/bin/perl
use v5.30;
use strict;
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "0PSeNfHMWWRg2pyr";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

do './install' if $run;
if($!) {
  die "$!\n";
}

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. The script is deleted by default.

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
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