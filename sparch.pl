#! /usr/bin/perl
use v5.30;
use strict;
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "DpG9CQTFyjJX8d7G";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

do './install' if $run;
if($!) {
  die "$!\n";
}

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. The script is deleted by default.

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
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