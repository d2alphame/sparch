#! /usr/bin/perl
use v5.30;
use strict;
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "ldQNE9k32FLJuIYR";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

do './install' if $run;
if($!) {
  die "$!\n";
}

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. By default, the original archive is deleted after extraction

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
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