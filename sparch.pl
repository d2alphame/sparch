#! /usr/bin/perl
use v5.30;
use strict;
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "zHXpC-px_KZs9MvU";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

chdir 'bin';
my $done = do './bin/install' if $run;
if($!) {
  die "$done: $!\n";
}

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. By default the original archive is deleted after extraction.

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
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