#! /usr/bin/perl
use v5.30;
use strict;
use warnings;
use Archive::Tar;
use MIME::Base64;
use Getopt::Long;

my $run = 1;
my $keep = 0;
my $compression = "xz";
my $temp_file = "GOrWg6qkOYop6aer";

# Process commandline options
GetOptions(
  'no-run' => sub{ $run = 0 },
  'keep' => \$keep 
) or (show_options_error() && exit 1);

mkdir "sparch";
chdir "sparch";

# Open a temporary working file
open(my $temp_handle, '>', $temp_file) or die "Cannot open temporary file: $!";
binmode $temp_handle;

# Base64-decode the data attached to this script
my $base64_data = <DATA>;
print $temp_handle decode_base64($base64_data);
close $temp_handle;

# Decompress and extract the file archive
Archive::Tar->extract_archive($temp_file, $compression);

do './install' if $run;
if($!) {
  die "$!\n";
}

unlink $temp_file;
chdir '..';
unlink $0 unless $keep;

sub show_options_error {
  say <<EOHELP;
USAGE:
  --keep
    Keep the archive after extraction. The script is deleted by default.

  --no-run
    Do not run script after extraction. If the archive was created with a --script option,
    the script will be executed after extraction. --no-run prevents the script from running.
EOHELP

  return 1;
}

# Attached tar archive compressed and base64 encoded
__DATA__
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